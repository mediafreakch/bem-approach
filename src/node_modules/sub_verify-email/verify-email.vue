<template>
  <h1 class="h1">E-Mail-Addresse aktualisieren</h1>
  <p v-if="message && message.type == 'success'">Sie haben Ihre E-Mail-Addresse erfolgreich aktualisiert.</p>
  <button
    class="btn btn-block"
    v-if="message"
    :class="[{ 'btn-success': states.isSuccess }, { 'btn-danger': states.isError }]"
    ><span class="icon icon-checkmark" v-if="states.isSuccess"></span> {{ message.body }}</button>
</template>
<script>
  var formElements = require('ricardo-element_form-elements');

  module.exports = {
    route: {
      data: function(transition) {
        transition.next({
          token: transition.to.params.token
        });
      }
    },
    data: function() {
      return {
        token: null,
        message: null
      }
    },
    computed: {
      states: function() {
        return {
          isSuccess: this.message && (this.message.type == 'success'),
          isError: this.message && this.message.type == 'danger'
        }
      }
    },
    methods: {
      verifyToken: function() {
        return this.$http.post('http://localhost:3000/users/123/email/verify', { data: { token: this.token } });
      }
    },
    ready: function() {
      this.verifyToken()
        .then(function(response) {
          this.message = {
            type: 'success',
            body: 'Aktualisierung best√§tigt'
          };
        }, function(response) {
          this.message = {
            type: 'danger',
            body: 'Ein Fehler ist aufgetreten. Code: TOKEN_VERIFICATION_FAILED'
          };
        });
    }
  };
</script>
