"use strict";

var handleErrorCase = require('app~utils').ajax.handleErrorCase;

module.exports = {
  sendRecreateEmailAndPassword: function( ctx ) {
    ctx.setFormIsRetrievingDataState( true );
    ctx.removeError();
    return ctx.$http.post( 'http://localhost:3000/users/' + encodeURI( ctx.user.id ) + 'restoreEmailAndPassword', {
      data: {
        email: ctx.forms.formReCreateEmailAndPassword.inputs.newEmail,
        password: ctx.forms.formReCreateEmailAndPassword.inputs.newPassword,
        token: ctx.user.tempToken
      }
    } )
      .then( function success ( response ) {
        ctx.setFormIsRetrievingDataState( false );
        ctx.setConfirmationEmailSent();
      }, function error ( response ) {
        ctx.setFormIsRetrievingDataState( false );
        handleErrorCase( ctx, response );
      } );
  }
};