<style lang="less">

</style>

<template>
  <h1>Konto wiederherstellen</h1>
  <r-alert
      v-if="activeForm === 'formReCreateEmailAndPassword'"
      type="success"
      icon="checkmark"
  >Danke!</r-alert>
  <p v-if="activeForm === 'formReCreateEmailAndPassword'">
    Sie wurden als Inhaber dieses Kontos bestätigt. Aktualisieren Sie jetzt
    Ihre E-Mail-Adresse und Ihr Passwort.
  </p>
  <r-alert
      v-if="activeForm === 'formReCreateEmailAndPassword'"
      type="warning"
      icon="alert"
  >Prüfen Sie vor dem Absenden sorgfältig Ihre neue E&#8209;Mail-Adresse.</r-alert>
  <form>
    <r-form-item
        variant="email"
        :label="emailLabel"
        input-id="newEmail"
        type="email"
        validation-type="['required', 'email']"
        validation-message="['Bitte füllen Sie dieses Feld aus um weiterzufahren.', 'Bitte geben Sie eine gültige E&#8209;Mail-Adresse ein.']"
        :vuexNameSpace="formReCreateEmailAndPassword"
        :readonly="isConfirmationEmailSent"
        :editable="isConfirmationEmailSent"
        @value-change="inputValueChanged"
        @input-enter="tryToSendForm"
        @input-blur="setUserNewEmail"
        @input-edit="editEmail"
    ></r-form-item>
    <r-form-item
        v-if="activeForm === 'formReCreateEmailAndPassword'"
        variant="password"
        label="Neues Passwort"
        validation-type="['required']"
        validation-message="['Bitte füllen Sie dieses Feld aus um weiterzufahren']"
        input-id="newPassword"
        type="password"
        @value-change="inputValueChanged"
        @input-enter="tryToSendForm"
        @input-blur="setUserNewPassword"
    ></r-form-item>
    <r-form-item
        v-if="activeForm === 'formEditEmail' && !isConfirmationEmailSent"
        variant="password"
        label="Bestätigen Sie die Änderung mit Ihrem neuen Passwort"
        validation-type="['required']"
        validation-message="['Bitte füllen Sie dieses Feld aus um weiterzufahren']"
        input-id="password"
        type="password"
        @value-change="inputValueChanged"
        @input-enter="tryToSendForm"
        @input-blur="setUserPassword"
    ></r-form-item>
    <p v-if="isConfirmationEmailSent">
      Sie haben ihr Konto erfolgreich wiederhergestellt. Viel Spass auf ricardo.ch.
    </p>

    <button
        @click.prevent="tryToSendForm"
        class="btn btn-primary btn-block btn-iconed"
    >
      {{submitWording}}
      <span v-if="isRequestSmsRetrievingData">&nbsp;<span class="icon icon-spinner rotating"></span></span>
    </button>
  </form>


</template>

<script>

  var
    alert = require( 'component~alert' ),
    formElements = require('element~form-elements'),
    formItem = formElements.components.formItem,
    vuexActions = require('./vuex/actions'),
    vuexGetters = require('./vuex/getters'),
    api = require('./js/api');


  module.exports = {
    components: {
      'r-alert': alert,
      'r-form-item': formItem
    },
    vuex:{
      actions: vuexActions,
      getters: vuexGetters
    },
    mixins: [
        api
    ],
    computed: {
      submitWording: function() {
        if(this.isConfirmationEmailSent) {
          return 'Zur Homepage';
        } else if (this.activeForm === 'formEditEmail') {
          return 'E-Mail-Addresse aktualisieren';
        }
        return 'Konto aktualisieren';
      },
      emailLabel: function() {
        if(this.activeForm === 'formEditEmail') {
          return 'Ihre neue E-Mail-Addresse';
        }
        return 'Neue E-Mail-Addresse';
      }
    },
    methods: {
      inputChanged: function() {
        console.log('inputChanged');
      },
      formReCreateEmailAndPasswordTryToSend: function() {
        this.sendRecreateEmailAndPassword();
      },
      formEditEmailTryToSend: function() {
        if(this.isConfirmationEmailSent) {
          location.href="//www.ricardo.ch";
        } else {
          this.sendEditEmail();
        }
      },
      tryToSendForm: function() {
        this[this.activeForm + 'TryToSend']()
      },
      editEmail: function() {
        this.setActiveForm('formEditEmail');
        this.setConfirmationEmailSent(false);
        console.log('this functionality has to be specified first');
      }
    }
  };

</script>