<style lang="less">

</style>

<template>
  <r-panel title="Personal information" type="editable" v-if="user">
    <button class="btn btn-cancel" slot="editable" @click="toggleEditMode('personalData')" v-show="!states.personalData.isEditMode">Edit</button>
    <div>
      <form novalidate>
        <r-button-group
            group-id="salutation"
            :buttons="salutationEnum"
            :value="user.salutation"
            label="Salutation"
            :readonly="!states.personalData.isEditMode"
            validation-type="required"
            validation-message="Please select a saluation."
        ></r-button-group>
        <r-form-item
            label="Firstname"
            input-id="firstname"
            type="text"
            placeholder="Firstname"
            :default-value="user.firstname"
            :readonly="!states.personalData.isEditMode"
        ></r-form-item>
        <r-form-item
            label="Lastname"
            input-id="lastname"
            type="text"
            placeholder="Lastname"
            :default-value="user.lastname"
            :readonly="!states.personalData.isEditMode"
        ></r-form-item>
        <r-form-item
            label="Username"
            input-id="username"
            type="text"
            placeholder="Username"
            :default-value="user.username"
            :readonly="!states.personalData.isEditMode"
        ></r-form-item>
        <r-form-item
            label="Birthdate"
            input-id="birthdate"
            type="text"
            placeholder="Birthdate"
            :default-value="user.birthdate"
            :readonly="!states.personalData.isEditMode"
        ></r-form-item>
        <r-button-group
            group-id="userLanguage"
            :buttons="languageEnum"
            :value="user.language"
            label="Language"
            :readonly="!states.personalData.isEditMode"
            validation-type="required"
            validation-message="Please select a language."
        ></r-button-group>
        <template v-if="states.personalData.isEditMode">
          <button class="btn btn-cancel" @click.prevent="abort('personalData')">Abort</button>
          <button class="btn btn-primary pull-right" @click.prevent="confirm('personalData')">Confirm</button>
        </template>
      </form>
    </div>
  </r-panel>
  <r-panel title="E-Mail-Address" type="editable" v-if="user">
    <button class="btn btn-cancel" slot="editable" @click="toggleEditMode('emailData')" v-show="!states.emailData.isEditMode">Edit</button>
    <r-form-item
        label="Current E-Mail Address"
        input-id="oldemail"
        type="text"
        placeholder="E-mail"
        :default-value="user.email"
        readonly
    ></r-form-item>
    <label v-if="isNewEmailPending">New E-Mail-Address</label>
    <r-change-email v-if="states.emailData.isEditMode"></r-change-email>
    <router-view></router-view>
  </r-panel>
  <r-panel title="Password" type="editable">
    <button class="btn btn-cancel" slot="editable" @click="toggleEditMode('passwordData')" v-show="!states.passwordData.isEditMode">Edit</button>
    <form v-if="states.passwordData.isEditMode">
      <r-form-item
        label="Current password"
        input-id="currentPw"
        type="text"
        placeholder="Current password"
      ></r-form-item>
      <r-form-item
        label="New password"
        input-id="newPw"
        type="text"
        placeholder="New password"
      ></r-form-item>
      <r-form-item
        label="Confirm password"
        input-id="confirmPw"
        type="text"
        placeholder="Confirm password"
      ></r-form-item>
      <button class="btn btn-cancel" @click.prevent="abort('passwordData')">Abort</button>
      <button class="btn btn-primary pull-right" @click.prevent="confirm('passwordData')">Confirm</button>
    </form>
  </r-panel>
  <r-panel title="Ratings"></r-panel>
</template>

<script>
  var panel = require('ricardo-component_panel'),
      formElements = require('ricardo-element_form-elements'),
      formItem = formElements.components.formItem,
      buttonGroup = formElements.components.buttonGroup,
      utils = require('ricardo-element_utils'),
      changeEmailView = require('sub_change-email');

  module.exports = {
    components: {
      'r-panel': panel,
      'r-form-item': formItem,
      'r-change-email': changeEmailView,
      'r-button-group': buttonGroup
    },
    data: function() {
      return {
        states: {
          personalData: {
            isEditMode: false
          },
          emailData: {
            isEditMode: false
          },
          passwordData: {
            isEditMode: false
          }
        },
        salutationEnum: [
          {
            id: 'male',
            label: 'Male'
          },
          {
            id: 'female',
            label: 'Female'
          }
        ],
        languageEnum: [
          {
            id: 'english',
            label: 'English'
          },
          {
            id: 'french',
            label: 'Fran√ßais'
          },
          {
            id: 'german',
            label: 'Deutsch'
          }
        ]
      }
    },
    computed: {
        isNewEmailPending: function() {
          return this.$route && this.$route.params.isNewPending;
        },
        user: function() {
          return this.$store.getters.user;
        }
    },
    methods: {
      toggleEditMode: function(area) {
        this.states[area].isEditMode = !this.states[area].isEditMode;
      },
      abort: function(area) {
        this.toggleEditMode(area);
      },
      confirm: function(area) {
        // do some fancy stuff like serializing the form
        this.toggleEditMode(area);
      },
      getUserInfo: function() {
        this.$store.dispatch('getUserInfo')
          .then();
      }
    },
    created: function() {
      if (!this.user) this.getUserInfo();
    }
  };
</script>
